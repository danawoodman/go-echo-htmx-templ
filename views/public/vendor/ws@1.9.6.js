!function(){var e;function t(t){return null!=e.getInternalData(t).webSocket}function n(t){return!e.bodyContains(t)&&(e.getInternalData(t).webSocket.close(),!0)}function r(e){var t=new WebSocket(e,[]);return t.binaryType=htmx.config.wsBinaryType,t}function s(t,n){var r=[];return(e.hasAttribute(t,n)||e.hasAttribute(t,"hx-ws"))&&r.push(t),t.querySelectorAll("["+n+"], [data-"+n+"], [data-hx-ws], [hx-ws]").forEach(function(e){r.push(e)}),r}function i(e,t){if(e)for(var n=0;n<e.length;n++)t(e[n])}htmx.defineExtension("ws",{init:function(t){e=t,htmx.createWebSocket||(htmx.createWebSocket=r),htmx.config.wsReconnectDelay||(htmx.config.wsReconnectDelay="full-jitter")},onEvent:function(r,a){switch(r){case"htmx:beforeCleanupElement":var o=e.getInternalData(a.target);o.webSocket&&o.webSocket.close();return;case"htmx:beforeProcessNode":var c=a.target;i(s(c,"ws-connect"),function(t){(function t(r){if(e.bodyContains(r)){var s=e.getAttributeValue(r,"ws-connect");if(null==s||""===s){var i=function t(n){var r=e.getAttributeValue(n,"hx-ws");if(r)for(var s,i=(s=r).trim().split(/\s+/),a=0;a<i.length;a++){var o=i[a].split(/:(.+)/);if("connect"===o[0])return o[1]}}(r);if(null==i)return;s=i}if(0===s.indexOf("/")){var a=location.hostname+(location.port?":"+location.port:"");"https:"===location.protocol?s="wss://"+a+s:"http:"===location.protocol&&(s="ws://"+a+s)}var o,c,u,f=(o=r,c=function(){return htmx.createWebSocket(s)},u={socket:null,messageQueue:[],retryCount:0,events:{},addEventListener:function(e,t){this.socket&&this.socket.addEventListener(e,t),this.events[e]||(this.events[e]=[]),this.events[e].push(t)},sendImmediately:function(t,n){this.socket||e.triggerErrorEvent(),n&&e.triggerEvent(n,"htmx:wsBeforeSend",{message:t,socketWrapper:this.publicInterface})&&(this.socket.send(t),n&&e.triggerEvent(n,"htmx:wsAfterSend",{message:t,socketWrapper:this.publicInterface}))},send:function(e,t){this.socket.readyState!==this.socket.OPEN?this.messageQueue.push({message:e,sendElt:t}):this.sendImmediately(e,t)},handleQueuedMessages:function(){for(;this.messageQueue.length>0;){var e=this.messageQueue[0];if(this.socket.readyState===this.socket.OPEN)this.sendImmediately(e.message,e.sendElt),this.messageQueue.shift();else break}},init:function(){this.socket&&this.socket.readyState===this.socket.OPEN&&this.socket.close();var t=c();e.triggerEvent(o,"htmx:wsConnecting",{event:{type:"connecting"}}),this.socket=t,t.onopen=function(t){u.retryCount=0,e.triggerEvent(o,"htmx:wsOpen",{event:t,socketWrapper:u.publicInterface}),u.handleQueuedMessages()},t.onclose=function(t){if(!n(o)&&[1006,1012,1013].indexOf(t.code)>=0){var r,s,i=(r=u.retryCount,s=htmx.config.wsReconnectDelay,"function"==typeof s?s(r):"full-jitter"===s?1e3*Math.pow(2,Math.min(r,6))*Math.random():void logError('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"'));setTimeout(function(){u.retryCount+=1,u.init()},i)}e.triggerEvent(o,"htmx:wsClose",{event:t,socketWrapper:u.publicInterface})},t.onerror=function(t){e.triggerErrorEvent(o,"htmx:wsError",{error:t,socketWrapper:u}),n(o)};var r=this.events;Object.keys(r).forEach(function(e){r[e].forEach(function(n){t.addEventListener(e,n)})})},close:function(){this.socket.close()}},u.init(),u.publicInterface={send:u.send.bind(u),sendImmediately:u.sendImmediately.bind(u),queue:u.messageQueue},u);f.addEventListener("message",function(t){if(!n(r)){var s=t.data;if(e.triggerEvent(r,"htmx:wsBeforeMessage",{message:s,socketWrapper:f.publicInterface})){e.withExtensions(r,function(e){s=e.transformResponse(s,null,r)});var i=e.makeSettleInfo(r),a=e.makeFragment(s);if(a.children.length)for(var o=Array.from(a.children),c=0;c<o.length;c++)e.oobSwap(e.getAttributeValue(o[c],"hx-swap-oob")||"true",o[c],i);e.settleImmediately(i.tasks),e.triggerEvent(r,"htmx:wsAfterMessage",{message:s,socketWrapper:f.publicInterface})}}}),e.getInternalData(r).webSocket=f}})(t)}),i(s(c,"ws-send"),function(r){var s,i;s=r,i=e.getAttributeValue(s,"hx-ws"),(!i||"send"===i)&&function t(r,s){var i=e.getInternalData(s);e.getTriggerSpecs(s).forEach(function(t){e.addTriggerHandler(s,t,i,function(t,i){if(!n(r)){var a=e.getInternalData(r).webSocket,o=e.getHeaders(s,e.getTarget(s)),c=e.getInputValues(s,"post"),u=c.errors,f=c.values,l=e.getExpressionVars(s),g=e.mergeObjects(f,l),h={parameters:e.filterValues(g,s),unfilteredParameters:g,headers:o,errors:u,triggeringEvent:i,messageBody:void 0,socketWrapper:a.publicInterface};if(e.triggerEvent(t,"htmx:wsConfigSend",h)){if(u&&u.length>0){e.triggerEvent(t,"htmx:validation:halted",u);return}var d=h.messageBody;if(void 0===d){var v=Object.assign({},h.parameters);h.headers&&(v.HEADERS=o),d=JSON.stringify(v)}a.send(d,t),e.shouldCancel(i,t)&&i.preventDefault()}}})})}(e.getClosestMatch(s,t),s)})}}})}();